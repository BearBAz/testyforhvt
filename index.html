<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ระบบจองห้องประชุม ศกฟ.</title>
    <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

<style>
    :root {
        --primary: #00B900;
        --primary-dark: #009900;
        --primary-light: #E8F8E8;
        --secondary: #06C755;
        --accent: #FFB800;
        --success: #10B981;
        --danger: #EF4444;
        --warning: #F59E0B;
        --info: #3B82F6;
        --dark: #111827;
        --gray-50: #F9FAFB;
        --gray-100: #F3F4F6;
        --gray-200: #E5E7EB;
        --gray-300: #D1D5DB;
        --gray-400: #9CA3AF;
        --gray-500: #6B7280;
        --gray-600: #4B5563;
        --gray-700: #374151;
        --gray-800: #1F2937;
        --gray-900: #111827;
        --white: #FFFFFF;
        --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
        --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
        --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        --shadow-2xl: 0 25px 50px -12px rgb(0 0 0 / 0.25);
        --radius-sm: 8px;
        --radius: 12px;
        --radius-lg: 16px;
        --radius-xl: 20px;
        --radius-2xl: 24px;
        --radius-full: 9999px;
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Sarabun', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        background: var(--gray-50);
        color: var(--gray-900);
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        overflow-x: hidden;
    }

    /* Modern Container */
    .app-wrapper {
        max-width: 100vw;
        min-height: 100vh;
        background: var(--gray-50);
    }

    /* Mobile Header - Glassmorphism Style */
    .mobile-header {
        background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        padding: 2rem 1.25rem 8rem;
        position: relative;
        overflow: hidden;
    }

    .mobile-header::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -20%;
        width: 300px;
        height: 300px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        filter: blur(60px);
    }

    .mobile-header::after {
        content: '';
        position: absolute;
        bottom: -30%;
        left: -10%;
        width: 250px;
        height: 250px;
        background: rgba(255, 255, 255, 0.08);
        border-radius: 50%;
        filter: blur(50px);
    }

    .header-content {
        position: relative;
        z-index: 2;
        text-align: center;
    }

    .header-icon {
        width: 72px;
        height: 72px;
        background: rgba(255, 255, 255, 0.25);
        backdrop-filter: blur(20px);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: var(--radius-xl);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 1rem;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
    }

    .header-icon i {
        font-size: 2rem;
        color: var(--white);
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
    }

    .header-title {
        font-size: 1.75rem;
        font-weight: 800;
        color: var(--white);
        margin-bottom: 0.5rem;
        letter-spacing: -0.025em;
        text-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .header-subtitle {
        font-size: 0.95rem;
        color: rgba(255, 255, 255, 0.95);
        font-weight: 400;
        line-height: 1.6;
    }

    /* Main Content */
    .main-content {
        margin-top: -5rem;
        padding: 0 1rem 2rem;
        position: relative;
        z-index: 10;
    }

    /* Modern Progress Steps */
    .progress-card {
        background: var(--white);
        border-radius: var(--radius-xl);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        box-shadow: var(--shadow-lg);
        border: 1px solid var(--gray-100);
    }

    .steps-container {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        position: relative;
    }

    .step-line {
        position: absolute;
        top: 28px;
        left: 16.66%;
        right: 16.66%;
        height: 3px;
        background: var(--gray-200);
        border-radius: var(--radius-full);
    }

    .step-line-progress {
        position: absolute;
        top: 0;
        left: 0;
        height: 100%;
        background: linear-gradient(90deg, var(--primary), var(--secondary));
        border-radius: var(--radius-full);
        width: 0%;
        transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 0 12px rgba(0, 185, 0, 0.4);
    }

    .step {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
        z-index: 2;
    }

    .step-number {
        width: 56px;
        height: 56px;
        border-radius: var(--radius-full);
        background: var(--white);
        border: 3px solid var(--gray-200);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 1.25rem;
        color: var(--gray-400);
        margin-bottom: 0.75rem;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: var(--shadow);
    }

    .step.active .step-number {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        border-color: var(--primary);
        color: var(--white);
        transform: scale(1.1);
        box-shadow: 0 0 0 8px rgba(0, 185, 0, 0.1), var(--shadow-lg);
    }

    .step.completed .step-number {
        background: var(--primary);
        border-color: var(--primary);
        color: var(--white);
        box-shadow: var(--shadow-md);
    }

    .step.completed .step-number::after {
        content: '\f00c';
        font-family: "Font Awesome 6 Free";
        font-weight: 900;
    }

    .step.completed .step-number span,
    .step.active .step-number span {
        display: none;
    }

    .step.completed .step-number::after {
        display: block;
    }

    .step-label {
        font-size: 0.8rem;
        color: var(--gray-500);
        font-weight: 600;
        text-align: center;
        line-height: 1.3;
        transition: all 0.3s ease;
    }

    .step.active .step-label {
        color: var(--primary);
        font-weight: 700;
    }

    /* Modern Form Card */
    .form-card {
        background: var(--white);
        border-radius: var(--radius-xl);
        padding: 1.75rem;
        margin-bottom: 1.25rem;
        box-shadow: var(--shadow-lg);
        border: 1px solid var(--gray-100);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .form-card:hover {
        box-shadow: var(--shadow-xl);
        transform: translateY(-2px);
    }

    .card-header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid var(--gray-100);
    }

    .card-icon {
        width: 48px;
        height: 48px;
        border-radius: var(--radius-lg);
        background: linear-gradient(135deg, var(--primary-light), rgba(6, 199, 85, 0.1));
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .card-icon i {
        font-size: 1.5rem;
        color: var(--primary);
    }

    .card-title {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--gray-900);
        letter-spacing: -0.025em;
    }

    /* Modern Form Elements */
    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-label {
        display: block;
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--gray-700);
        margin-bottom: 0.5rem;
        letter-spacing: -0.01em;
    }

    .form-label.required::after {
        content: '*';
        color: var(--danger);
        margin-left: 0.25rem;
    }

    .form-control {
        width: 100%;
        padding: 0.875rem 1rem;
        font-size: 1rem;
        font-weight: 500;
        color: var(--gray-900);
        background: var(--white);
        border: 2px solid var(--gray-200);
        border-radius: var(--radius-lg);
        transition: all 0.2s ease;
        font-family: 'Sarabun', sans-serif;
    }

    .form-control:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 4px rgba(0, 185, 0, 0.1);
        background: var(--white);
    }

    .form-control:hover:not(:focus) {
        border-color: var(--gray-300);
    }

    .form-control::placeholder {
        color: var(--gray-400);
        font-weight: 400;
    }

    /* Custom Dropdown */
    .custom-select {
        position: relative;
    }

    .select-button {
        width: 100%;
        padding: 0.875rem 1rem;
        font-size: 1rem;
        font-weight: 500;
        color: var(--gray-900);
        background: var(--white);
        border: 2px solid var(--gray-200);
        border-radius: var(--radius-lg);
        text-align: left;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .select-button:hover {
        border-color: var(--gray-300);
    }

    .select-button.open {
        border-color: var(--primary);
        box-shadow: 0 0 0 4px rgba(0, 185, 0, 0.1);
    }

    .select-button .placeholder {
        color: var(--gray-400);
    }

    .select-button .arrow {
        color: var(--gray-500);
        transition: transform 0.3s ease;
    }

    .select-button.open .arrow {
        transform: rotate(180deg);
        color: var(--primary);
    }

    .select-dropdown {
        position: absolute;
        top: calc(100% + 8px);
        left: 0;
        right: 0;
        background: var(--white);
        border: 1px solid var(--gray-200);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-xl);
        max-height: 300px;
        overflow-y: auto;
        z-index: 1000;
        display: none;
        padding: 0.5rem;
    }

    .select-dropdown.show {
        display: block;
        animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .select-option {
        padding: 1rem;
        border-radius: var(--radius);
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.25rem;
    }

    .select-option:hover:not(.disabled) {
        background: var(--gray-50);
    }

    .select-option.disabled {
        opacity: 0.5;
        cursor: not-allowed;
        background: var(--gray-50);
    }

    .option-info {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }

    .option-name {
        font-weight: 600;
        color: var(--gray-900);
    }

    .option-capacity {
        font-size: 0.875rem;
        color: var(--gray-500);
        display: flex;
        align-items: center;
        gap: 0.35rem;
    }

    .status-badge {
        padding: 0.375rem 0.75rem;
        border-radius: var(--radius-full);
        font-size: 0.75rem;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 0.35rem;
        white-space: nowrap;
    }

    .status-available {
        background: rgba(16, 185, 129, 0.1);
        color: var(--success);
    }

    .status-unavailable {
        background: rgba(239, 68, 68, 0.1);
        color: var(--danger);
    }

    /* Radio Cards with Airbnb Style */
    .radio-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        margin-top: 0.75rem;
    }

    .radio-card {
        position: relative;
        padding: 1.5rem;
        border: 2px solid var(--gray-200);
        border-radius: var(--radius-xl);
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        text-align: center;
        background: var(--white);
    }

    .radio-card:hover {
        border-color: var(--gray-400);
        transform: translateY(-4px);
        box-shadow: var(--shadow-lg);
    }

    .radio-card.active {
        border-color: var(--primary);
        background: linear-gradient(135deg, var(--primary-light), rgba(6, 199, 85, 0.05));
        box-shadow: 0 0 0 4px rgba(0, 185, 0, 0.1), var(--shadow-md);
    }

    .radio-card input[type="radio"] {
        display: none;
    }

    .radio-icon {
        width: 56px;
        height: 56px;
        margin: 0 auto 0.75rem;
        border-radius: var(--radius-lg);
        background: var(--gray-100);
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }

    .radio-card.active .radio-icon {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        transform: scale(1.1);
    }

    .radio-icon i {
        font-size: 1.75rem;
        color: var(--gray-500);
        transition: all 0.3s ease;
    }

    .radio-card.active .radio-icon i {
        color: var(--white);
    }

    .radio-label {
        font-weight: 600;
        color: var(--gray-700);
        font-size: 0.95rem;
    }

    .radio-card.active .radio-label {
        color: var(--primary);
        font-weight: 700;
    }

    /* Date Range */
    .date-range {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
    }

    /* Accommodation Result - Booking.com Inspired */
    .accommodation-result {
        margin-top: 1.5rem;
        background: var(--white);
        border: 2px solid var(--gray-200);
        border-radius: var(--radius-xl);
        overflow: hidden;
        box-shadow: var(--shadow-md);
    }

    .result-header {
        background: linear-gradient(135deg, var(--primary-light), rgba(6, 199, 85, 0.08));
        padding: 1.25rem 1.5rem;
        border-bottom: 2px solid var(--gray-100);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .result-title {
        font-weight: 700;
        color: var(--primary);
        font-size: 1.1rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .nights-badge {
        padding: 0.375rem 0.875rem;
        background: var(--white);
        border: 1px solid var(--gray-200);
        border-radius: var(--radius-full);
        font-size: 0.875rem;
        font-weight: 700;
        color: var(--gray-700);
    }

    .result-body {
        padding: 1.5rem;
    }

    .info-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    .info-item {
        background: var(--gray-50);
        padding: 1rem;
        border-radius: var(--radius-lg);
        position: relative;
        overflow: hidden;
        border: 1px solid var(--gray-100);
    }

    .info-item::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background: linear-gradient(180deg, var(--primary), var(--secondary));
    }

    .info-label {
        font-size: 0.75rem;
        color: var(--gray-500);
        margin-bottom: 0.25rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.025em;
    }

    .info-value {
        font-size: 0.95rem;
        font-weight: 700;
        color: var(--gray-900);
    }

    .info-time {
        font-size: 0.75rem;
        color: var(--gray-500);
        margin-top: 0.25rem;
    }

    .availability-status {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 1rem 1.25rem;
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.08), rgba(16, 185, 129, 0.03));
        border: 2px solid rgba(16, 185, 129, 0.2);
        border-radius: var(--radius-lg);
        margin-bottom: 1.5rem;
    }

    .status-text {
        font-weight: 700;
        color: var(--success);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .rooms-badge {
        padding: 0.5rem 1rem;
        background: var(--success);
        color: var(--white);
        border-radius: var(--radius-full);
        font-weight: 800;
        font-size: 1rem;
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    .room-input-section {
        background: var(--white);
        border-top: 2px dashed var(--gray-200);
        padding-top: 1.5rem;
    }

    .input-with-helper {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
    }

    .input-wrapper {
        flex: 0 0 100px;
    }

    .helper-wrapper {
        flex: 1;
    }

    .helper-text {
        font-size: 0.875rem;
        color: var(--gray-600);
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .helper-text.recommend {
        color: var(--success);
        font-weight: 600;
    }

    .helper-text i {
        flex-shrink: 0;
    }

    /* Unavailable Message */
    .unavailable-alert {
        margin-top: 1.5rem;
        padding: 1.5rem;
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.08), rgba(239, 68, 68, 0.03));
        border: 2px solid rgba(239, 68, 68, 0.2);
        border-radius: var(--radius-xl);
    }

    .alert-header {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .alert-icon {
        width: 48px;
        height: 48px;
        flex-shrink: 0;
        background: var(--danger);
        color: var(--white);
        border-radius: var(--radius-full);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
    }

    .alert-content h6 {
        font-weight: 700;
        color: var(--danger);
        margin-bottom: 0.25rem;
    }

    .alert-content small {
        color: var(--gray-500);
        font-size: 0.875rem;
    }

    .alert-message {
        padding: 1rem;
        background: rgba(239, 68, 68, 0.05);
        border-left: 4px solid var(--danger);
        border-radius: var(--radius);
        font-size: 0.9rem;
        color: var(--gray-700);
    }

    /* PDPA Checkbox */
    .pdpa-card {
        background: linear-gradient(135deg, var(--primary-light), rgba(6, 199, 85, 0.05));
        border: 2px solid rgba(0, 185, 0, 0.2);
        border-radius: var(--radius-xl);
        padding: 1.5rem;
        margin-top: 1.5rem;
    }

    .checkbox-wrapper {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
    }

    .custom-checkbox {
        width: 28px;
        height: 28px;
        flex-shrink: 0;
        border: 2px solid var(--primary);
        border-radius: var(--radius-sm);
        cursor: pointer;
        appearance: none;
        transition: all 0.2s ease;
        position: relative;
    }

    .custom-checkbox:checked {
        background: var(--primary);
        border-color: var(--primary);
    }

    .custom-checkbox:checked::after {
        content: '\f00c';
        font-family: "Font Awesome 6 Free";
        font-weight: 900;
        color: var(--white);
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 0.875rem;
    }

    .pdpa-text {
        flex: 1;
        font-size: 0.95rem;
        color: var(--gray-700);
        line-height: 1.6;
    }

    .pdpa-link {
        color: var(--primary);
        font-weight: 700;
        text-decoration: none;
        border-bottom: 2px dashed var(--primary);
        transition: all 0.2s ease;
    }

    .pdpa-link:hover {
        color: var(--primary-dark);
        border-bottom-color: var(--primary-dark);
    }

    /* Submit Button - Premium Style */
    .submit-section {
        margin-top: 2rem;
        text-align: center;
    }

    .btn-submit {
        padding: 1.25rem 3rem;
        font-size: 1.125rem;
        font-weight: 700;
        color: var(--white);
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        border: none;
        border-radius: var(--radius-xl);
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 8px 24px rgba(0, 185, 0, 0.3);
        position: relative;
        overflow: hidden;
        display: inline-flex;
        align-items: center;
        gap: 0.75rem;
    }

    .btn-submit::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        transform: translateX(-100%);
        transition: transform 0.6s ease;
    }

    .btn-submit:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 32px rgba(0, 185, 0, 0.4);
    }

    .btn-submit:hover::before {
        transform: translateX(100%);
    }

    .btn-submit:active {
        transform: translateY(-2px);
    }

    .btn-submit:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
    }

    /* Footer Contact */
    .contact-footer {
        margin-top: 2rem;
        padding: 1.5rem;
        background: var(--white);
        border: 1px solid var(--gray-200);
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow);
    }

    .contact-info {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .contact-icon {
        width: 48px;
        height: 48px;
        flex-shrink: 0;
        background: linear-gradient(135deg, var(--primary-light), rgba(6, 199, 85, 0.1));
        border-radius: var(--radius-lg);
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .contact-icon i {
        font-size: 1.5rem;
        color: var(--primary);
    }

    .contact-text {
        flex: 1;
    }

    .contact-label {
        font-size: 0.875rem;
        color: var(--gray-500);
        font-weight: 600;
        margin-bottom: 0.25rem;
    }

    .contact-value {
        font-size: 1rem;
        font-weight: 700;
        color: var(--gray-900);
    }

    /* Loading Overlay */
    .loading-overlay {
        position: fixed;
        inset: 0;
        background: rgba(255, 255, 255, 0.98);
        backdrop-filter: blur(10px);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 9999;
    }

    .loading-overlay.show {
        display: flex;
    }

    .loading-content {
        text-align: center;
    }

    .loading-spinner {
        width: 64px;
        height: 64px;
        border: 4px solid var(--gray-200);
        border-top-color: var(--primary);
        border-radius: var(--radius-full);
        animation: spin 1s linear infinite;
        margin: 0 auto 1.5rem;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    .loading-text {
        font-size: 1.125rem;
        font-weight: 600;
        color: var(--gray-700);
    }

    /* Desktop Styles - Modern Dashboard */
    @media (min-width: 768px) {
        body {
            background: linear-gradient(135deg, #F0F9FF 0%, #E0F2FE 100%);
        }

        .app-wrapper {
            display: flex;
            min-height: 100vh;
        }

        .mobile-header {
            display: none;
        }

        /* Sidebar */
        .desktop-sidebar {
            width: 420px;
            background: linear-gradient(180deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 3rem 2.5rem;
            position: relative;
            overflow: hidden;
            box-shadow: 8px 0 32px rgba(0, 0, 0, 0.12);
        }

        .desktop-sidebar::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -30%;
            width: 600px;
            height: 600px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 50%;
            filter: blur(80px);
        }

        .sidebar-content {
            position: relative;
            z-index: 2;
        }

        .sidebar-logo {
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(20px);
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-2xl);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 2rem;
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.2);
        }

        .sidebar-logo i {
            font-size: 3rem;
            color: var(--white);
        }

        .sidebar-title {
            font-size: 2.25rem;
            font-weight: 800;
            color: var(--white);
            margin-bottom: 0.75rem;
            line-height: 1.2;
        }

        .sidebar-subtitle {
            font-size: 1.05rem;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 3rem;
            line-height: 1.6;
        }

        .sidebar-steps {
            display: flex;
            flex-direction: column;
            gap: 2.5rem;
            margin-bottom: 3rem;
        }

        .sidebar-step {
            display: flex;
            align-items: flex-start;
            gap: 1.5rem;
            position: relative;
        }

        .sidebar-step:not(:last-child)::after {
            content: '';
            position: absolute;
            left: 28px;
            top: 60px;
            width: 3px;
            height: calc(100% + 2.5rem - 60px);
            background: rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-full);
        }

        .sidebar-step.completed:not(:last-child)::after {
            background: rgba(255, 255, 255, 0.4);
        }

        .sidebar-step-circle {
            width: 56px;
            height: 56px;
            background: rgba(255, 255, 255, 0.15);
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.6);
            flex-shrink: 0;
            transition: all 0.4s ease;
            backdrop-filter: blur(10px);
        }

        .sidebar-step.active .sidebar-step-circle {
            background: var(--white);
            border-color: var(--white);
            color: var(--primary);
            transform: scale(1.1);
            box-shadow: 0 0 0 10px rgba(255, 255, 255, 0.2);
        }

        .sidebar-step.completed .sidebar-step-circle {
            background: rgba(255, 255, 255, 0.95);
            border-color: var(--white);
            color: var(--primary);
        }

        .sidebar-step-content {
            padding-top: 0.5rem;
        }

        .sidebar-step-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.75);
            margin-bottom: 0.5rem;
        }

        .sidebar-step.active .sidebar-step-title {
            color: var(--white);
        }

        .sidebar-step-desc {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.6);
            line-height: 1.5;
        }

        .sidebar-footer-box {
            margin-top: auto;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-xl);
        }

        .footer-contact {
            display: flex;
            align-items: center;
            gap: 1.25rem;
        }

        .footer-contact i {
            font-size: 1.75rem;
            color: var(--white);
        }

        .footer-contact-text {
            flex: 1;
        }

        .footer-contact-label {
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.75);
            margin-bottom: 0.25rem;
        }

        .footer-contact-value {
            font-size: 1.05rem;
            font-weight: 700;
            color: var(--white);
        }

        /* Desktop Main */
        .desktop-main {
            flex: 1;
            padding: 3rem;
            overflow-y: auto;
        }

        .main-content {
            max-width: 900px;
            margin: 0 auto;
            padding: 0;
        }

        .progress-card {
            display: none;
        }

        .welcome-card {
            background: var(--white);
            border-radius: var(--radius-2xl);
            padding: 3rem;
            margin-bottom: 2.5rem;
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--gray-100);
        }

        .welcome-header {
            display: flex;
            align-items: center;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .welcome-icon {
            width: 90px;
            height: 90px;
            background: linear-gradient(135deg, var(--primary-light), rgba(6, 199, 85, 0.1));
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .welcome-icon i {
            font-size: 2.75rem;
            color: var(--primary);
        }

        .welcome-title {
            font-size: 2rem;
            font-weight: 800;
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }

        .welcome-subtitle {
            font-size: 1.05rem;
            color: var(--gray-600);
        }

        .welcome-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 2rem;
            padding-top: 2rem;
            border-top: 2px solid var(--gray-100);
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: block;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.95rem;
            color: var(--gray-600);
            font-weight: 600;
        }

        .form-card {
            padding: 2.5rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        .form-row-room {
            display: grid;
            grid-template-columns: 7fr 3fr;
            gap: 1.5rem;
        }

        .btn-submit {
            padding: 1.35rem 3.5rem;
        }

        .contact-footer {
            display: none;
        }
    }

    /* Responsive */
    @media (max-width: 767px) {
        .desktop-sidebar,
        .welcome-card {
            display: none;
        }

        .form-row,
        .form-row-room {
            display: block;
        }

        .form-row .form-group,
        .form-row-room .form-group {
            margin-bottom: 1.5rem;
        }
    }

    /* Animations */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .form-card {
        animation: fadeInUp 0.5s ease-out;
    }

    .form-card:nth-child(1) { animation-delay: 0.1s; }
    .form-card:nth-child(2) { animation-delay: 0.2s; }
    .form-card:nth-child(3) { animation-delay: 0.3s; }

    /* Custom Scrollbar */
    ::-webkit-scrollbar {
        width: 10px;
    }

    ::-webkit-scrollbar-track {
        background: var(--gray-100);
    }

    ::-webkit-scrollbar-thumb {
        background: var(--gray-400);
        border-radius: var(--radius-full);
    }

    ::-webkit-scrollbar-thumb:hover {
        background: var(--gray-500);
    }
</style>
</head>
<body>
    <div class="app-wrapper">
        <!-- Desktop Sidebar -->
        <aside class="desktop-sidebar">
            <div class="sidebar-content">
                <div class="sidebar-logo">
                    <i class="fas fa-bolt"></i>
                </div>
                <h1 class="sidebar-title">ระบบจองห้องประชุม</h1>
                <p class="sidebar-subtitle">ศูนย์ศึกปฏิบัติการไฟฟ้าแรงสูง การไฟฟ้าส่วนภูมิภาค</p>
                
                <div class="sidebar-steps">
                    <div class="sidebar-step active" id="desktop-step-1">
                        <div class="sidebar-step-circle"><span>1</span></div>
                        <div class="sidebar-step-content">
                            <div class="sidebar-step-title">ข้อมูลผู้จอง</div>
                            <div class="sidebar-step-desc">กรอกชื่อ-นามสกุล หน่วยงาน และเบอร์ติดต่อ</div>
                        </div>
                    </div>
                    <div class="sidebar-step" id="desktop-step-2">
                        <div class="sidebar-step-circle"><span>2</span></div>
                        <div class="sidebar-step-content">
                            <div class="sidebar-step-title">รายละเอียดการจอง</div>
                            <div class="sidebar-step-desc">เลือกห้องประชุม วันที่ และจำนวนผู้เข้าร่วม</div>
                        </div>
                    </div>
                    <div class="sidebar-step" id="desktop-step-3">
                        <div class="sidebar-step-circle"><span>3</span></div>
                        <div class="sidebar-step-content">
                            <div class="sidebar-step-title">ยืนยันการจอง</div>
                            <div class="sidebar-step-desc">ตรวจสอบข้อมูลและส่งคำขอจอง</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="sidebar-footer-box">
                <div class="footer-contact">
                    <i class="fas fa-phone-alt"></i>
                    <div class="footer-contact-text">
                        <div class="footer-contact-label">ติดต่อสอบถามโทร.</div>
                        <div class="footer-contact-value">034-339-224 และ (33)15619</div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="desktop-main">
            <!-- Mobile Header -->
            <header class="mobile-header">
                <div class="header-content">
                    <div class="header-icon">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <h1 class="header-title">ระบบจองห้องประชุม</h1>
                    <p class="header-subtitle">ศูนย์ศึกปฏิบัติการไฟฟ้าแรงสูง การไฟฟ้าส่วนภูมิภาค</p>
                </div>
            </header>

            <div class="main-content">
                <!-- Welcome Card (Desktop Only) -->
                <div class="welcome-card">
                    <div class="welcome-header">
                        <div class="welcome-icon">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div>
                            <h2 class="welcome-title">ยินดีต้อนรับสู่ระบบจองห้องประชุม</h2>
                            <p class="welcome-subtitle">กรุณากรอกข้อมูลให้ครบถ้วนเพื่อทำการจองห้องประชุมและที่พัก</p>
                        </div>
                    </div>
                    <div class="welcome-stats">
                        <div class="stat-item">
                            <span class="stat-value">13</span>
                            <span class="stat-label">ห้องประชุมทั้งหมด</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value">90</span>
                            <span class="stat-label">ห้องพักทั้งหมด</span>
                        </div>
                    </div>
                </div>

                <!-- Progress Steps (Mobile Only) -->
                <div class="progress-card">
                    <div class="steps-container">
                        <div class="step-line">
                            <div class="step-line-progress"></div>
                        </div>
                        <div class="step active" id="mobile-step-1">
                            <div class="step-number"><span>1</span></div>
                            <div class="step-label">ข้อมูลผู้จอง</div>
                        </div>
                        <div class="step" id="mobile-step-2">
                            <div class="step-number"><span>2</span></div>
                            <div class="step-label">รายละเอียด</div>
                        </div>
                        <div class="step" id="mobile-step-3">
                            <div class="step-number"><span>3</span></div>
                            <div class="step-label">ยืนยัน</div>
                        </div>
                    </div>
                </div>

                <!-- Booking Form -->
                <form id="bookingForm">
                    <!-- User Information Card -->
                    <div class="form-card">
                        <div class="card-header">
                            <div class="card-icon">
                                <i class="fas fa-user-circle"></i>
                            </div>
                            <h3 class="card-title">ข้อมูลผู้จอง</h3>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="fullName" class="form-label required">ชื่อ-นามสกุล</label>
                                <input type="text" class="form-control" id="fullName" name="fullName" 
                                       placeholder="กรุณากรอกชื่อ-นามสกุล" required>
                            </div>
                            <div class="form-group">
                                <label for="department" class="form-label required">สังกัด/ชื่อหน่วยงาน</label>
                                <input type="text" class="form-control" id="department" name="department" 
                                       placeholder="กรุณากรอกสังกัด/ชื่อหน่วยงาน" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="phone" class="form-label required">เบอร์โทรศัพท์</label>
                            <input type="tel" class="form-control" id="phone" name="phone" 
                                   placeholder="กรุณากรอกเบอร์โทรศัพท์" required>
                        </div>
                    </div>

                    <!-- Booking Details Card -->
                    <div class="form-card">
                        <div class="card-header">
                            <div class="card-icon">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <h3 class="card-title">ข้อมูลการจองห้องประชุม</h3>
                        </div>
                        
                        <div class="form-group">
                            <label for="courseName" class="form-label required">ชื่อหลักสูตร/หัวข้อประชุม</label>
                            <input type="text" class="form-control" id="courseName" name="courseName" 
                                   placeholder="กรุณากรอกชื่อหลักสูตร/หัวข้อประชุม" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required">ช่วงเวลา</label>
                            <div class="date-range">
                                <div>
                                    <label for="startDate" class="form-label" style="font-size: 0.875rem; font-weight: 500;">วันที่เริ่มต้น</label>
                                    <input type="date" class="form-control" id="startDate" name="startDate" required>
                                </div>
                                <div>
                                    <label for="endDate" class="form-label" style="font-size: 0.875rem; font-weight: 500;">วันที่สิ้นสุด</label>
                                    <input type="date" class="form-control" id="endDate" name="endDate" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row-room">
                            <div class="form-group">
                                <label for="meetingRoom" class="form-label required">เลือกห้องประชุม</label>
                                <div class="custom-select">
                                    <button type="button" class="select-button" id="selectButton">
                                        <span class="placeholder">กรุณาเลือกห้องประชุม</span>
                                        <i class="fas fa-chevron-down arrow"></i>
                                    </button>
                                    <div class="select-dropdown" id="selectDropdown"></div>
                                    <input type="hidden" id="meetingRoom" name="meetingRoom" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="attendees" class="form-label required">จำนวนผู้เข้าร่วม</label>
                                <input type="number" class="form-control" id="attendees" name="attendees" 
                                       placeholder="จำนวน (คน)" required min="1"
                                       oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label required">ต้องการที่พัก</label>
                            <div class="radio-grid">
                                <div class="radio-card" data-value="ต้องการ">
                                    <input type="radio" name="accommodation" value="ต้องการ" required>
                                    <div class="radio-icon">
                                        <i class="fas fa-bed"></i>
                                    </div>
                                    <div class="radio-label">ต้องการ</div>
                                </div>
                                <div class="radio-card" data-value="ไม่ต้องการ">
                                    <input type="radio" name="accommodation" value="ไม่ต้องการ">
                                    <div class="radio-icon">
                                        <i class="fas fa-home"></i>
                                    </div>
                                    <div class="radio-label">ไม่ต้องการ</div>
                                </div>
                            </div>
                        </div>

                        <div id="accommodationStatus"></div>
                    </div>

                    <!-- PDPA Consent -->
                    <div class="pdpa-card">
                        <div class="checkbox-wrapper">
                            <input type="checkbox" class="custom-checkbox" id="pdpaConsent" required>
                            <label for="pdpaConsent" class="pdpa-text">
                                ข้าพเจ้ายินยอมให้เก็บรวบรวม และเปิดเผยข้อมูลส่วนบุคคลเพื่อวัตถุประสงค์ในการจองห้องพัก และห้องประชุมของศูนย์ศึกปฏิบัติการไฟฟ้าแรงสูง ตาม
                                <a href="#" class="pdpa-link" onclick="showPDPADetail(event)">
                                    พระราชบัญญัติคุ้มครองข้อมูลส่วนบุคคล พ.ศ. 2562 (PDPA)
                                </a>
                            </label>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="submit-section">
                        <button type="submit" class="btn-submit" id="submitBtn">
                            <i class="fas fa-paper-plane"></i>
                            <span>ส่งข้อมูลการจอง</span>
                        </button>
                    </div>
                </form>

                <!-- Mobile Footer Contact -->
                <div class="contact-footer">
                    <div class="contact-info">
                        <div class="contact-icon">
                            <i class="fas fa-phone-alt"></i>
                        </div>
                        <div class="contact-text">
                            <div class="contact-label">ติดต่อสอบถามโทร.</div>
                            <div class="contact-value">034-339-224 และ (33)15619</div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">กำลังส่งข้อมูลการจอง...</div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const LIFF_ID = "2007138631-Ono58j50";
    const GAS_WEB_APP_URL = "https://script.google.com/macros/s/AKfycby8VAtdyxSMkPIIWNBAqUa9YJw2XNT7-fcPqbsSPqsk1IkrVex0X83DUMcGOmIdCJLPMw/exec";

    const mainContent = document.getElementById('mainContent');
    const bookingForm = document.getElementById('bookingForm');
    const submitBtn = document.getElementById('submitBtn');
    const messageContainer = document.getElementById('messageContainer');
    const loadingDiv = document.getElementById('loading');
    const accommodationStatusDiv = document.getElementById('accommodationStatus');
    const customMeetingRoomSelect = document.getElementById('customMeetingRoomSelect');
    const meetingRoomOptions = document.getElementById('meetingRoomOptions');
    const hiddenMeetingRoomInput = document.getElementById('meetingRoom');
    let userId = '';
    let displayName = '';
    let checkTimeout;
    let roomData = [];
    let accommodationAvailable = true;

    async function initializeLiff() {
        try {
            await liff.init({ liffId: LIFF_ID });
            if (!liff.isLoggedIn()) {
                liff.login();
                return;
            }
            const profile = await liff.getProfile();
            userId = profile.userId;
            displayName = profile.displayName;
            
            await autofillUserData();
            updateProgressSteps();
        } catch (err) {
            console.error('LIFF initialization error:', err);
        }
    }

    async function autofillUserData() {
        if (!userId) return;
        const autofillUrl = `${GAS_WEB_APP_URL}?userId=${userId}`;
        try {
            const response = await fetch(autofillUrl);
            const userData = await response.json();
            if (userData && userData.fullName) {
                document.getElementById('fullName').value = userData.fullName;
                document.getElementById('department').value = userData.department;
                document.getElementById('phone').value = userData.phone;
                updateProgressSteps();
            }
        } catch (error) {
            console.error('Autofill error:', error);
        }
    }

    function updateProgressSteps() {
        const step1Fields = ['fullName', 'department', 'phone'];
        const step2Fields = ['courseName', 'startDate', 'endDate', 'meetingRoom', 'attendees'];
        const accommodationChecked = document.querySelector('input[name="accommodation"]:checked') !== null;
        const step1Complete = step1Fields.every(field => document.getElementById(field).value.trim() !== '');
        const step2Complete = step2Fields.every(field => document.getElementById(field).value.trim() !== '') && accommodationChecked;
        // Mobile steps
        const step1El = document.getElementById('step1');
        const step2El = document.getElementById('step2');
        const step3El = document.getElementById('step3');

        if (step1El && step2El && step3El) {
            step1El.classList.toggle('completed', step1Complete);
            step1El.classList.toggle('active', !step1Complete);

            if (step1Complete) {
                step2El.classList.add('active');
                step2El.classList.toggle('completed', step2Complete);
            } else {
                step2El.classList.remove('active', 'completed');
            }

            if (step2Complete) {
                step3El.classList.add('active');
            } else {
                step3El.classList.remove('active');
            }

            const progressFill = document.querySelector('.progress-line-fill');
            if (progressFill) {
                let progressPercent = 0;
                if (step1Complete && step2Complete) progressPercent = 100;
                else if (step1Complete) progressPercent = 50;
                progressFill.style.width = progressPercent + '%';
            }
        }

        const desktopStep1 = document.getElementById('desktop-step1');
        const desktopStep2 = document.getElementById('desktop-step2');
        const desktopStep3 = document.getElementById('desktop-step3');

        if (desktopStep1 && desktopStep2 && desktopStep3) {
            desktopStep1.classList.toggle('completed', step1Complete);
            desktopStep1.classList.toggle('active', !step1Complete);

            if (step1Complete) {
                desktopStep2.classList.add('active');
                desktopStep2.classList.toggle('completed', step2Complete);
            } else {
                desktopStep2.classList.remove('active', 'completed');
            }

            if (step2Complete) {
                desktopStep3.classList.add('active');
            } else {
                desktopStep3.classList.remove('active');
            }

            [desktopStep1, desktopStep2, desktopStep3].forEach(step => {
                const circle = step.querySelector('.sidebar-step-circle');
                const span = circle.querySelector('span');
                const icon = circle.querySelector('i');
            
                if (step.classList.contains('completed')) {
                    span.style.display = 'none';
                    icon.style.display = 'block';
                } else {
                    span.style.display = 'block';
                    icon.style.display = 'none';
                }
            });
        }
    }

        // Check accommodation availability
        async function checkAccommodation() {
            clearTimeout(checkTimeout);
            
            checkTimeout = setTimeout(async () => {
                const accommodationChoice = document.querySelector('input[name="accommodation"]:checked');
                const startDate = document.getElementById('startDate').value;
                const endDate = document.getElementById('endDate').value;
                const attendeesInput = document.getElementById('attendees').value;
                const attendees = parseInt(attendeesInput) || 0;
                const container = document.getElementById('accommodationStatus');

                maxAvailableRooms = 0;
                accommodationAvailable = true;

                if (!accommodationChoice || accommodationChoice.value !== 'ต้องการ') {
                    container.innerHTML = '';
                    return;
                }

                if (!startDate || !endDate || !attendeesInput || attendees <= 0) {
                    container.innerHTML = '';
                    return;
                }

                container.innerHTML = `
                    <div class="accommodation-result">
                        <div class="result-header">
                            <div class="result-title">
                                <i class="fas fa-spinner fa-spin"></i>
                                กำลังตรวจสอบห้องว่าง...
                            </div>
                        </div>
                    </div>
                `;

                try {
                    const startDateObj = new Date(startDate);
                    const endDateObj = new Date(endDate);
                    
                    const checkin = new Date(startDateObj);
                    checkin.setDate(startDateObj.getDate() - 1);
                    
                    const apiCheckout = new Date(endDateObj);
                    apiCheckout.setDate(endDateObj.getDate() - 1);

                    const diffTime = Math.abs(endDateObj - checkin);
                    const nights = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                    const checkinStr = checkin.toISOString().split('T')[0];
                    const apiCheckoutStr = apiCheckout.toISOString().split('T')[0];
                    
                    const dateOptions = { day: 'numeric', month: 'short', year: '2-digit' };
                    const showCheckin = checkin.toLocaleDateString('th-TH', dateOptions);
                    const showCheckout = endDateObj.toLocaleDateString('th-TH', dateOptions);

                    const response = await fetch(`${GAS_WEB_APP_URL}?action=checkAvailability&checkin=${checkinStr}&checkout=${apiCheckoutStr}`);
                    const result = await response.json();

                    if (result.error) throw new Error(result.error);

                    const available = result.availableRooms;
                    maxAvailableRooms = available;

                    const suggestedRooms = Math.ceil(attendees / 2);
                    
                    if (available > 0 && available >= suggestedRooms) {
                        accommodationAvailable = true;
                        const defaultInputValue = suggestedRooms;
                        const quotaLimit = suggestedRooms + 5;

                        container.innerHTML = `
                            <div class="accommodation-result">
                                <div class="result-header">
                                    <div class="result-title">
                                        <i class="fas fa-bed"></i>
                                        ข้อมูลการจองที่พัก
                                    </div>
                                    <span class="nights-badge">${nights} คืน</span>
                                </div>
                                <div class="result-body">
                                    <div class="info-grid">
                                        <div class="info-item">
                                            <div class="info-label">เข้าพัก (Check-in)</div>
                                            <div class="info-value">${showCheckin}</div>
                                            <div class="info-time">เวลา 14:00 น.</div>
                                        </div>
                                        <div class="info-item">
                                            <div class="info-label">คืนห้อง (Check-out)</div>
                                            <div class="info-value">${showCheckout}</div>
                                            <div class="info-time">เวลา 10:00 น.</div>
                                        </div>
                                    </div>

                                    <div class="availability-status">
                                        <div class="status-text">
                                            <i class="fas fa-check-circle"></i>
                                            ห้องพักว่าง
                                        </div>
                                        <div class="rooms-badge">${available} ห้อง</div>
                                    </div>

                                    <div class="room-input-section">
                                        <div class="form-group">
                                            <label for="numRooms" class="form-label required">ระบุจำนวนห้องพักที่ต้องการ</label>
                                            <div class="input-with-helper">
                                                <div class="input-wrapper">
                                                    <input type="number" class="form-control" id="numRooms" name="numRooms" 
                                                           min="1" max="${available}" value="${defaultInputValue}" required>
                                                </div>
                                                <div class="helper-wrapper">
                                                    <div class="helper-text recommend">
                                                        <i class="fas fa-user-friends"></i>
                                                        แนะนำ: ${suggestedRooms} ห้อง (สำหรับผู้เข้าอบรม ${attendees} ท่าน)
                                                    </div>
                                                    <div class="helper-text">
                                                        <i class="fas fa-info-circle"></i>
                                                        ห้องพัก standard สามารถพักได้ 2 ท่าน/ห้อง
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="invalid-feedback" id="roomAlert" style="display:none;"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;

                        const numRoomsInput = document.getElementById('numRooms');
                        const roomAlert = document.getElementById('roomAlert');
                        
                        numRoomsInput.addEventListener('input', function() {
                            const val = parseInt(this.value);
                            if (isNaN(val) || val <= 0) {
                                this.classList.add('is-invalid');
                                roomAlert.style.display = 'block';
                                roomAlert.innerHTML = '<i class="fas fa-exclamation-circle"></i> กรุณาระบุอย่างน้อย 1 ห้อง';
                            } else if (val > maxAvailableRooms) {
                                this.classList.add('is-invalid');
                                roomAlert.style.display = 'block';
                                roomAlert.innerHTML = `<i class="fas fa-exclamation-circle"></i> ห้องว่างเหลือเพียง ${maxAvailableRooms} ห้อง`;
                            } else if (val > quotaLimit) {
                                this.classList.add('is-invalid');
                                roomAlert.style.display = 'block';
                                roomAlert.innerHTML = `<i class="fas fa-exclamation-circle"></i> ไม่สามารถจองห้องพักเกินโควต้าที่กำหนดได้ โปรดติดต่อ admin ผ่าน Line OA`;
                            } else {
                                this.classList.remove('is-invalid');
                                roomAlert.style.display = 'none';
                            }
                        });

                    } else {
                        accommodationAvailable = false;

                        let errorTitle = "ห้องพักไม่เพียงพอ";
                        let errorDesc = `ต้องการห้องพักจำนวน ${suggestedRooms} ห้อง แต่มีห้องพักว่างเพียง ${available} ห้อง`;
                        
                        if (available === 0) {
                            errorTitle = "ห้องพักเต็ม";
                            errorDesc = "ไม่มีห้องพักว่างในช่วงเวลาดังกล่าว";
                        }

                        container.innerHTML = `
                            <div class="unavailable-alert">
                                <div class="alert-header">
                                    <div class="alert-icon">
                                        <i class="fas fa-times"></i>
                                    </div>
                                    <div class="alert-content">
                                        <h6>${errorTitle}</h6>
                                        <small>ระหว่างวันที่ ${showCheckin} - ${showCheckout}</small>
                                    </div>
                                </div>
                                <div class="alert-message">
                                    <i class="fas fa-exclamation-triangle"></i> ${errorDesc}<br>
                                    <strong>โปรดเลือกช่วงเวลาอื่น หรือลดจำนวนผู้เข้าอบรม</strong>
                                </div>
                            </div>
                        `;
                    }

                } catch (error) {
                    console.error('Accommodation check error:', error);
                    accommodationAvailable = true;
                    container.innerHTML = `
                        <div class="unavailable-alert">
                            <div class="alert-message">
                                <i class="fas fa-exclamation-triangle"></i> ไม่สามารถตรวจสอบสถานะห้องพักได้ในขณะนี้
                            </div>
                        </div>
                    `;
                }
            }, 600);
        }

        // Form submission
        document.getElementById('bookingForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const pdpaCheckbox = document.getElementById('pdpaConsent');
            if (!pdpaCheckbox.checked) {
                await Swal.fire({
                    title: 'กรุณายอมรับเงื่อนไข',
                    text: 'ท่านต้องยอมรับนโยบาย PDPA ก่อนทำการจองห้องประชุม',
                    icon: 'warning',
                    confirmButtonText: 'ตกลง'
                });
                pdpaCheckbox.scrollIntoView({ behavior: 'smooth', block: 'center' });
                return;
            }

            const accommodationChoice = document.querySelector('input[name="accommodation"]:checked');
            let numRoomsValue = 0;

            if (accommodationChoice && accommodationChoice.value === 'ต้องการ') {
                const numRoomsInput = document.getElementById('numRooms');
                if (numRoomsInput) {
                    numRoomsValue = parseInt(numRoomsInput.value) || 0;
                    
                    const currentAttendees = parseInt(document.getElementById('attendees').value) || 0;
                    const suggested = Math.ceil(currentAttendees / 2);
                    const quotaLimit = suggested + 5;

                    if (numRoomsValue > maxAvailableRooms) {
                        await Swal.fire({
                            title: 'ห้องพักไม่เพียงพอ!',
                            html: `ห้องพักว่างเพียง <b>${maxAvailableRooms}</b> ห้อง<br>กรุณาระบุจำนวนไม่เกินยอดคงเหลือ`,
                            icon: 'warning',
                            confirmButtonText: 'แก้ไขข้อมูล'
                        });
                        numRoomsInput.focus();
                        return;
                    }

                    if (numRoomsValue > quotaLimit) {
                        await Swal.fire({
                            title: 'เกินโควต้าที่กำหนด',
                            text: 'ไม่สามารถจองห้องพักเกินโควต้าที่กำหนดได้ โปรดติดต่อ admin ผ่าน Line OA',
                            icon: 'warning',
                            confirmButtonText: 'ตกลง'
                        });
                        numRoomsInput.focus();
                        return;
                    }
                    
                    if (numRoomsValue <= 0) {
                        await Swal.fire({
                            title: 'ข้อมูลไม่ถูกต้อง',
                            text: 'กรุณาระบุจำนวนห้องพักอย่างน้อย 1 ห้อง',
                            icon: 'warning',
                            confirmButtonText: 'ตกลง'
                        });
                        return;
                    }
                } else if (!accommodationAvailable) {
                    await Swal.fire({
                        title: 'ที่พักไม่เพียงพอ!',
                        text: 'ไม่มีห้องพักว่างในช่วงเวลาดังกล่าว กรุณาเปลี่ยนช่วงเวลา',
                        icon: 'error',
                        confirmButtonText: 'ตกลง'
                    });
                    return;
                }
            }

            const selectedRoom = document.getElementById('meetingRoom').value;
            const attendees = parseInt(document.getElementById('attendees').value) || 0;
            const roomConfig = roomData.find(r => r.name === selectedRoom);

            if (roomConfig && attendees > roomConfig.capacity) {
                await Swal.fire({
                    title: 'จำนวนผู้เข้าร่วมเกินความจุห้อง!',
                    text: `ห้อง ${selectedRoom} รองรับได้ ${roomConfig.capacity} คน แต่มีผู้เข้าร่วม ${attendees} คน`,
                    icon: 'error',
                    confirmButtonText: 'ตกลง'
                });
                return;
            }

            if (roomConfig && !roomConfig.isAvailable) {
                await Swal.fire({
                    title: 'ห้องประชุมไม่ว่าง!',
                    text: 'ห้องประชุมที่คุณเลือกไม่ว่างในช่วงเวลาที่กำหนด กรุณาเลือกห้องอื่น',
                    icon: 'error',
                    confirmButtonText: 'ตกลง'
                });
                return;
            }

            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>กำลังส่งข้อมูล...</span>';
            document.getElementById('loadingOverlay').classList.add('show');

            const formData = new FormData(e.target);
            const data = {
                userId: userId,
                displayName: displayName,
                fullName: formData.get('fullName'),
                department: formData.get('department'),
                phone: formData.get('phone'),
                courseName: formData.get('courseName'),
                startDate: formData.get('startDate'),
                endDate: formData.get('endDate'),
                meetingRoom: formData.get('meetingRoom'),
                accommodation: formData.get('accommodation'),
                attendees: formData.get('attendees'),
                numRooms: numRoomsValue,
                timestamp: new Date().toISOString()
            };

            try {
                await fetch(GAS_WEB_APP_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                document.getElementById('loadingOverlay').classList.remove('show');

                await Swal.fire({
                    title: 'บันทึกข้อมูลสำเร็จ!',
                    text: 'ระบบได้บันทึกข้อมูลการจองของคุณเรียบร้อยแล้ว และจะส่งสรุปให้ทาง LINE',
                    icon: 'success',
                    confirmButtonText: 'ตกลง',
                    allowOutsideClick: false
                }).then((result) => {
                    if (result.isConfirmed) {
                        if (liff.isInClient()) {
                            liff.closeWindow();
                        } else {
                            window.close();
                        }
                    }
                });

            } catch (error) {
                console.error('Submit error:', error);
                document.getElementById('loadingOverlay').classList.remove('show');
                
                await Swal.fire({
                    title: 'เกิดข้อผิดพลาด!',
                    text: 'ไม่สามารถส่งข้อมูลได้ กรุณาลองใหม่อีกครั้ง',
                    icon: 'error',
                    confirmButtonText: 'ลองอีกครั้ง'
                });
                
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i><span>ส่งข้อมูลการจอง</span>';
            }
        });

        // Event listeners
        document.querySelectorAll('.radio-card').forEach(card => {
            card.addEventListener('click', function() {
                document.querySelectorAll('.radio-card').forEach(c => c.classList.remove('active'));
                this.classList.add('active');
                const radio = this.querySelector('input[type="radio"]');
                radio.checked = true;
                radio.dispatchEvent(new Event('change'));
                updateProgressSteps();
            });
        });

        document.getElementById('selectButton').addEventListener('click', function() {
            const dropdown = document.getElementById('selectDropdown');
            this.classList.toggle('open');
            dropdown.classList.toggle('show');
        });

        document.addEventListener('click', function(e) {
            const selectButton = document.getElementById('selectButton');
            const dropdown = document.getElementById('selectDropdown');
            if (!selectButton.contains(e.target) && !dropdown.contains(e.target)) {
                selectButton.classList.remove('open');
                dropdown.classList.remove('show');
            }
        });

        document.querySelectorAll('input, select').forEach(input => {
            input.addEventListener('input', updateProgressSteps);
            input.addEventListener('change', updateProgressSteps);
        });

        document.getElementById('startDate').addEventListener('change', () => {
            checkMeetingRoomAvailability();
            checkAccommodation();
        });

        document.getElementById('endDate').addEventListener('change', () => {
            checkMeetingRoomAvailability();
            checkAccommodation();
        });

        document.getElementById('attendees').addEventListener('input', checkAccommodation);

        document.querySelectorAll('input[name="accommodation"]').forEach(radio => {
            radio.addEventListener('change', checkAccommodation);
        });

        // PDPA modal
        function showPDPADetail(e) {
            e.preventDefault();
            Swal.fire({
                title: 'เพื่อปฏิบัติตามพระราชบัญญัติคุ้มครองข้อมูลส่วนบุคคล พ.ศ. 2562 (PDPA)',
                html: '<div style="text-align: left; font-size: 0.9rem; max-height: 400px; overflow-y: auto;">' +
                      '<p>ศูนย์ศึกปฏิบัติการไฟฟ้าแรงสูง ขอแจ้งให้ท่านทราบเกี่ยวกับวัตถุประสงค์และรายละเอียดการเก็บรวบรวม ใช้ และเปิดเผย (รวมเรียกว่า "การประมวลผล") ข้อมูลส่วนบุคคลของท่าน ดังนี้:</p>' +
                      '<p><b>1. ข้อมูลส่วนบุคคลที่จัดเก็บ:</b> ที่อยู่อีเมล (Email Address), บัญชีผู้ใช้งานแอปพลิเคชัน Line (Line ID/Account), หมายเลขโทรศัพท์ (Phone Number)</p>' +
                      '<p><b>2. วัตถุประสงค์ในการประมวลผลข้อมูล:</b> เพื่อใช้ในการติดต่อสื่อสารเกี่ยวกับการจองและการยืนยัน การจองห้องพักและห้องประชุมของศูนย์ศึกปฏิบัติการไฟฟ้าแรงสูงเพื่อแจ้งข้อมูลที่เกี่ยวข้องกับการใช้บริการ การเปลี่ยนแปลง หรือเหตุฉุกเฉินเกี่ยวกับห้องพัก/ห้องประชุมที่ท่านได้ทำการจองไว้</p>' +
                      '<p><b>3. ระยะเวลาในการเก็บรักษา:</b> ข้อมูลส่วนบุคคลข้างต้นจะถูกประมวลผลเพื่อวัตถุประสงค์ดังต่อไปนี้เท่านั้น: เพื่อใช้ในการติดต่อสื่อสารเกี่ยวกับการจองและการยืนยัน</p>' +
                      '<p><b>4. การให้ความยินยอม:</b> การที่ท่านให้ข้อมูลส่วนบุคคลดังกล่าวข้างต้นแก่ ศกฟ. และดำเนินการจองห้องพัก/ห้องประชุมของศูนย์ศึกปฏิบัติการไฟฟ้าแรงสูงเพื่อแจ้งข้อมูล ที่เกี่ยวข้องกับการใช้บริการ การเปลี่ยนแปลง หรือเหตุฉุกเฉินเกี่ยวกับห้องพัก/ห้องประชุมที่ท่านได้ทำการจองไว้</p>' +
                      '<p>ท่านมีสิทธิในการเข้าถึง ขอแก้ไข หรือเพิกถอนความยินยอมในการประมวลผลข้อมูลส่วนบุคคลของท่าน ภายใต้หลักเกณฑ์ที่กฎหมายกำหนด</p>' +
                      '</div>',
                icon: 'info',
                confirmButtonText: 'รับทราบ',
                width: '600px'
            });
        }

        // Set minimum date
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('startDate').setAttribute('min', today);
            document.getElementById('startDate').addEventListener('change', function() {
                document.getElementById('endDate').setAttribute('min', this.value);
            });
            updateProgressSteps();
        });

        // Initialize
        initializeLiff();
    </script>
</body>
</html>
